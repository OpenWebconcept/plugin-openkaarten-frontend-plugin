(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.blocks,a=window.React,n=window.wp.blockEditor,r=window.wp.components,l=window.wp.element,s=window.wp.i18n,o=window.wp.apiFetch;var i=e.n(o);const c=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","title":"OWC Openmaps Openstreet Map","description":"OWC Openmaps Openstreet Map","icon":"admin-site-alt","name":"owc-openkaarten/streetmap","category":"openkaarten-frontend-plugin","textdomain":"openkaarten-frontend-plugin","attributes":{"rest_uri":{"type":"string","default":""},"selected_datasets":{"type":"Array","default":[]}},"style":["owc-openkaarten-streetmap-block"],"supports":{"align":false,"className":false,"customClassName":false,"html":false,"multiple":false},"keywords":["owc","openwebconcept","openmaps","map","locations"],"viewScript":["owc-openkaarten-streetmap-block"],"version":"0.1.0"}'),{name:p}=c;(0,t.registerBlockType)(p,{...c,edit:function({attributes:e,setAttributes:t}){const[o,c]=(0,l.useState)(!1),[p,u]=(0,l.useState)(null),[d,m]=(0,l.useState)(e.selected_datasets),w=(0,l.useMemo)((()=>{try{return new URL(e.rest_uri),!0}catch(e){return!1}}),[e.rest_uri]);(0,l.useEffect)((()=>{w&&i()({url:`${e.rest_uri}/wp-json/owc/openkaarten/v1/datasets`}).then((e=>{u(e.datasets)})).catch((e=>{console.error("Fetching datasets failed",e),u([])}))}),[e.rest_uri,w]);const _=(0,l.useMemo)((()=>{if(!p)return[];const e=p.map((e=>({value:e.id.toString(),label:e.title?e.title:"Untitled"})));return e.unshift({value:"",label:(0,s.__)("Select the datalayers you want to display on the map","openkaarten-frontend-plugin"),disabled:!0}),e}),[p]);return(0,l.useLayoutEffect)((()=>{const e=_.filter((e=>d.includes(e.value))).map((e=>e.label)),t=document.getElementById("datalayers");t&&(t.innerHTML=e.length>0?e.join("<br>"):(0,s.__)("No datalayers selected","openkaarten-frontend-plugin"))}),[d,_]),(0,a.createElement)(a.Fragment,null,(0,a.createElement)(n.BlockControls,null),(0,a.createElement)("div",{className:"owc-openkaarten-streetmap"},(0,a.createElement)(r.__experimentalInputControl,{label:(0,s.__)("URL to rest-endpoint or Domain URL","openkaarten-frontend-plugin"),value:e.rest_uri,onChange:e=>{c(!0),t({rest_uri:e})},onBlur:()=>{c(!1)}}),!!e.rest_uri&&!o&&!w&&(0,a.createElement)(r.Notice,{status:"error"},(0,a.createElement)("p",null,(0,s.__)("Invalid URL","openkaarten-frontend-plugin"))),(0,a.createElement)("div",{className:"owc-openkaarten-streetmap__row"},(0,a.createElement)(r.SelectControl,{multiple:!0,label:(0,s.__)("Select datalayers:","openkaarten-frontend-plugin"),value:e.selected_datasets,onClick:e=>{const a=e.target.value?d.includes(e.target.value)?d.filter((t=>t!==e.target.value)):[...d,e.target.value]:[];m(a),t({selected_datasets:a})},options:_.length?_:[{value:"",label:(0,s.__)("No datalayers found","openkaarten-frontend-plugin"),disabled:!0}]}),(0,a.createElement)("div",{className:"components-message-box"},(0,a.createElement)("label",{className:"css-1imalal"},(0,s.__)("Selected datalayers","openkaarten-frontend-plugin")),(0,a.createElement)("p",{id:"datalayers"},(0,s.__)("No datalayers selected","openkaarten-frontend-plugin"))))))},save:()=>null})})();